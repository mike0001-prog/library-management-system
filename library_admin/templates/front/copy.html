 <table id="datatablesSimple">
                    <thead>
                        <tr>
                            <th>Name</th>
                            <th>Department</th>
                            <th>Gender</th>
                            <th>Age</th>
                            <th>Date Joined</th>
                            <th>identity</th>
                        </tr>
                    </thead>
                    <tfoot>
                        <!-- <tr>
                            <th>Name</th>
                            <th>Position</th>
                            <th>Office</th>
                            <th>Age</th>
                            <th>Start date</th>
                            <th>Salary</th>
                        </tr> -->
                        <tr>
                            <th>Name</th>
                            <th>Department</th>
                            <th>Gender</th>
                            <th>Age</th>
                            <th>Date Joined</th>
                            <th>identity</th>
                            <th>action</th>
                        </tr>
                    </tfoot>
                    <tbody>
                        {% for us in users %}
                        <tr>
                            <td>
                                <a href="{% url 'user_view' us.id us.first_name us.last_name %}">{{ us.first_name }} {{ us.last_name }}</a>
                                <!-- <a href="127.0.0.1:5000">flask</a> -->
                            </td>
                            <td>{{ us.profile.department }}</td>
                            <td>{{ us.profile.gender }}</td>
                            <td>{{ us.profile.d_o_b }}</td>
                            <td>{{ us.date_joined }}</td>
                            <td>{{ us.username }}</td>
                            <td class="user-action"> 
                            <form action="{% url 'activate_deactivate' %}" method="post">
                                {% csrf_token %}
                                <input type="hidden" name="uid" value="{{ us.id }}">
                                 {% if us.is_active %}
                                <input id="deactivate" type="hidden" name="action" value="deactivate" >
                                {% else %}
                                 <input id="activate" type="hidden" name="action" value="activate" >
                                 {% endif %}
                                  {% if us.is_active %}
                                 <button style="text-transform: capitalize; font-size: 2px;" class="btn btn-danger">deactivate</button>
                                {% else %}
                                <button style="text-transform: capitalize; font-size: 2px;" class="btn btn-success">activate</button>
                                 {% endif %}
                            </form>
                            </td>
                        </tr>
                        {% endfor %}
                    </tbody>
                </table>


                {% extends 'front/base.html' %}
{% load static %}
{% block title %}
    Dashboard - {{ request.user }}
{% endblock title %}
<!-- ============================================
============================================
============================================ -->
{% block department %}
          {% for d in depts %}
            <a class="nav-link us" href="{% url 'department_user' d.department %}">{{ d }}</a>
          {% endfor %}
{% endblock department %}

{% block main %}
    <div class="container-fluid px-4">
        <h1 class="mt-4">Dashboard</h1>
        <div id="msg"></div>
        <ol class="breadcrumb mb-4">
            <li class="breadcrumb-item active">Dashboard</li>
        </ol>

        <div class="row">
            <div class="col-xl-3 col-md-6">
                <div class="card bg-primary text-white mb-4">
                    <div class="card-footer d-flex align-items-center justify-content-between" style="padding: 0;">
                        <div class="card-left">
                            <div class="card-body" style="padding: 10px;">
                                    <span style="font-weight: 600;font-size: 25px;">{{ books|length }}</span> <br>
                                    Total Books
                            </div>
                        </div>
                        <!-- <div class="sb-nav-link-icon"><i class="fas fa-columns"></i></div> -->
                        <div class="card-right p-2 m-2" style="border-radius: 50px;background: #fff;">
                            <img src="{% static '\fontawesome\svgs\solid\book.svg' %}" width="40px" height="40px" style="transform: rotate(180deg);">
                        </div>
                    </div>
                    <div class="card-footer d-flex align-items-center justify-content-between">
                        <a class="small text-white stretched-link" href="#">View Details</a>
                        <div class="small text-white"><i class="fas fa-angle-right"></i></div>
                    </div>
                </div>
            </div>

            <div class="col-xl-3 col-md-6">
                <div class="card bg-warning text-white mb-4">
                    <div class="card-footer d-flex align-items-center justify-content-between" style="padding: 0;">
                        <div class="card-left">
                            <div class="card-body" style="padding: 10px;">
                                    <span style="font-weight: 600;font-size: 25px;">{{ borrowed|length }}</span> <br>
                                    Borrowed Books
                            </div>
                        </div>
                        <div class="card-right p-2 m-2" style="border-radius: 50px;background: #fff;">
                            <img src="{% static '\custom\borrow-book.png' %}" width="40px" height="40px">
                        </div>
                    </div>
                    <div class="card-footer d-flex align-items-center justify-content-between">
                        <a class="small text-white stretched-link" href="#">View Details</a>
                        <div class="small text-white"><i class="fas fa-angle-right"></i></div>
                    </div>
                </div>
            </div>

            <div class="col-xl-3 col-md-6">
                <div class="card bg-success text-white mb-4">
                    <div class="card-footer d-flex align-items-center justify-content-between" style="padding: 0;">
                        <div class="card-left">
                            <div class="card-body" style="padding: 10px;">
                                    <span style="font-weight: 600;font-size: 25px;">4</span> <br>
                                    Returned Books
                            </div>
                        </div>
                        <div class="card-right p-2 m-2" style="border-radius: 50px;background: #fff;">
                            <img src="{% static '\custom\returned book.png' %}" width="40px" height="40px">
                        </div>
                    </div>
                    <div class="card-footer d-flex align-items-center justify-content-between">
                        <a class="small text-white stretched-link" href="#">View Details</a>
                        <div class="small text-white"><i class="fas fa-angle-right"></i></div>
                    </div>
                </div>
            </div>

            <div class="col-xl-3 col-md-6">
                <div class="card bg-danger text-white mb-4">
                    <div class="card-footer d-flex align-items-center justify-content-between" style="padding: 0;">
                        <div class="card-left">
                            <div class="card-body" style="padding: 10px;">
                                    <span style="font-weight: 600;font-size: 25px;">3</span> <br>
                                    Unreturned Books
                            </div>
                        </div>
                        <div class="card-right p-2 m-2" style="border-radius: 50px;background: #fff;">
                            <img src="{% static '\custom\unreturned book.png' %}" width="40px" height="40px">
                        </div>
                    </div>
                    <div class="card-footer d-flex align-items-center justify-content-between">
                        <a class="small text-white stretched-link" href="#">View Details</a>
                        <div class="small text-white"><i class="fas fa-angle-right"></i></div>
                    </div>
                </div>
            </div>

        </div>
          <div class="card mb-4">
            <div class="card-header">
                <i class="fas fa-table me-1"></i>
                Users
            </div>
            <div class="card-body">
                               <table id="datatablesSimple">
                    <thead>
                         <tr>
                            <th>Name</th>
                            <th>Department</th>
                            <th>Gender</th>
                            <th>Age</th>
                            <th>Last Login</th>
                            <th>identity</th>
                            <th>action</th>
                        </tr>
                    </thead>
                    <tfoot>
                        <tr>
                            <th>Name</th>
                            <th>Department</th>
                            <th>Gender</th>
                            <th>Age</th>
                            <th>Last Login</th>
                            <th>identity</th>
                            <th>action</th>
                        </tr>
                    </tfoot>
                    <tbody>
                         {% for us in users %}
                        <tr>
                            <td>
                                <a href="{% url 'user_view' us.id us.first_name us.last_name %}">{{ us.first_name }} {{ us.last_name }}</a>
                            </td>
                            <td>{{ us.profile.department }}</td>
                            <td>{{ us.profile.gender }}</td>
                            <td>{{ us.profile.d_o_b }}</td>
                              <td>{{  us.last_login }}</td>
                              <td> {{ us.username }}</td>
                            <td class="user-action">
                                <form action="{% url 'activate_deactivate' %}" method="post">
                                {% csrf_token %}
                                <input type="hidden" name="uid" value="{{ us.id }}">
                                 {% if us.is_active %}
                                <input id="deactivate" type="hidden" name="action" value="deactivate" >
                                {% else %}
                                 <input id="activate" type="hidden" name="action" value="activate" >
                                 {% endif %}
                                  {% if us.is_active %}
                                 <button style="text-transform: capitalize; font-size: 10px;" class="btn btn-danger">deactivate</button>
                                {% else %}
                                <button style="text-transform: capitalize; font-size: 10px;" class="btn btn-success">activate</button>
                                 {% endif %}
                            </form>
                            </td>
                        </tr>
                        {% endfor %}
                    </tbody>
                </table>
            </div>
        </div>

        <div class="row">
            
            <div class="col-xl-12">
                <div class="card mb-4">
                    <div class="card-header">
                        <i class="fas fa-chart-bar me-1"></i>
                        Books Borrowed Per Month
                    </div>
                    <div class="card-body"><canvas id="borrowChart" width="100%" height="40"></canvas></div>
                </div>
            </div>
        </div>
         <script>
    const ctx = document.getElementById('borrowChart').getContext('2d');
    console.log(ctx)
    console.log({{ months|safe }})
    const borrowChart = new Chart(ctx, {
      type: 'bar',
      data: {
        labels: {{ months|safe }},   // Month labels from Django
        datasets: [{
          label: 'Books Borrowed',
          data: {{ counts|safe }},   // Counts from Django
          backgroundColor: '#143d02',
          borderColor: '#143d02',
          borderWidth: 1
        }]
      },
      options: {
        responsive: true,
    scales: {
      xAxes: [{
        time: {
          unit: 'month'
        },
        gridLines: {
          display: false
        },
        ticks: {
          maxTicksLimit: 6
        }
      }],
      yAxes: [{
        ticks: {
          min: 0,
          max: 10,
          maxTicksLimit: 5
        },
        gridLines: {
          display: true
        }
      }],
    },
    legend: {
      display: false
    }
  }
    });
    document.addEventListener("DOMContentLoaded",function () {
   console.log($(".user-action"))
    $(".user-action").on("submit","form",function (e) {
         e.preventDefault()
        console.log(e.target)
        console.log($(this).serialize())
        $.ajax({url:$(this).attr("action"),
            type:$(this).attr("method"),
            data:$(this).serialize(),
            success: function (response) {
                console.log(response)
                const parent = e.target
                const btn = parent.querySelector("button")
                if (response.action === "activated") {
                    
                    btn.innerHTML = `deactivate`
                    btn.classList.add("btn")
                    btn.classList.remove("btn-success")
                    btn.classList.add("btn-danger")
                    $("#msg").fadeIn(1000)
                    const input = parent.querySelectorAll("input")
                    console.log(input[2])
                    input[2].value = "deactivate"
                    const m = document.querySelector("#msg")
                    m.innerHTML = "User activated"
                    m.classList.add("alert")
                    m.classList.add("alert-success")
                    m.classList.remove("alert-danger")
                    $("#msg").fadeOut(2000)
                }else if(response.action === "deactivated"){
                btn.innerHTML = `activate`
                btn.classList.add("btn")
                btn.classList.remove("btn-danger")
                btn.classList.add("btn-success")
                $("#msg").fadeIn(1000)
                const input = parent.querySelectorAll("input")
                console.log(input[2])
                input[2].value = "activate"
                const m = document.querySelector("#msg")
                m.innerHTML = "User deactivated"
                m.classList.add("alert")

                m.classList.add("alert-danger")
                $("#msg").fadeOut(2000)
                console.log("d")
                }
                
            }
        })
    })
     })
     
   
                </script>
      
    </div>
{% endblock main %}